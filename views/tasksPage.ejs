<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tesks</title>
        <style>
         body {
  font-family: Arial, sans-serif;
  background-color: cornflowerblue;
  margin: 40px;
  color: #333;
}

h2 {
  color: white;
  margin-bottom: 10px;
}


.container{
  display: flex;
  flex-direction: row;
  justify-content: center;
}
.container form {
    margin-bottom: 20px;
  background-color: #ffffffcc;
  padding: 15px;
  border-radius: 6px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  max-width: 600px;
  margin-right: 20px;
  flex: 1;
}
.container form h2{
color: black;
}

form label {
  font-weight: bold;
  display: inline-block;
  margin-bottom: 4px;
  font-size: 14px;
  color: #333;
}

form input[type="text"],
form input[type="date"],
form select,
form textarea {
  display: block;
  width: 100%;
  max-width: 350px;
  padding: 6px 10px;
  margin-bottom: 14px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 13px;
  transition: border-color 0.2s, box-shadow 0.2s;
}

form textarea {
  resize: none;
}

form input[type="text"]:focus,
form input[type="date"]:focus,
form select:focus,
form textarea:focus {
  border-color: #007bff;
  box-shadow: 0 0 2px rgba(0, 123, 255, 0.4);
  outline: none;
}

input[type="submit"],
button {
  padding: 6px 14px;
  background-color: #007bff;
  border: none;
  border-radius: 4px;
  color: white;
  cursor: pointer;
  font-size: 13px;
  transition: background-color 0.3s;
  margin-left: 6px;
}

input[type="submit"]:hover,
button:hover {
  background-color: #0056b3;
}

table {
  width: 100%;
  border-collapse: collapse;
  background-color: white;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

th, td {
  border: 1px solid #ddd;
  padding: 10px;
  text-align: center;
}

th {
  background-color: #f0f0f0;
  font-weight: bold;
}

td form {
  display: inline;
}

.pagination {
  text-align: center;
  margin-top: 20px;
}

.pagination button {
  margin: 0 5px;
}

h4 {
  color: white;
  font-style: italic;
}
#pageNav {
  display: flex;
  justify-content: center;
  margin-top: 20px;
}

#pageNav form {
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 12px 20px;
  background-color: #ffffffdd; /* לבן חצי שקוף */
  border-radius: 8px;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
  border: 1px solid #ccc;
  transition: box-shadow 0.3s ease;
  cursor: default;
}


        </style>
    </head>
    <body>
      <div class="container">
        <form action="http://localhost:7777/tasks" method="post">
            <h2>Add Task</h2>
            <select name="category" id="category" >
                <option value="0" selected>No Category</option>
                <%for( let i = 0;i < data.categories.length; i++){%>
                    <option value="<%= Object.values(data.categories[i])[0] %>"><%= Object.values(data.categories[i])[1] %></option>
                <%}%>
            </select>
            <textarea name="description" id="description" placeholder="Description..." style="resize: none;" cols="30" rows="3"></textarea>
            <label for="date">Date:</label><input type="date" required name="date" id="date">

            <input type="submit" value="Add Task" id="addTaskBtn">
        </form>
        <form action="http://localhost:7777/tasks/page" method="get">
          <h2>Sort By</h2>
            <label for="category">category:</label>
            <select name="category" id="category" >

              <%if(data.sortParameters.category === '0'){%>
              
                <option value="0" selected>All</option>
                <option value="-1">No Category</option>
              
              <%} else if(data.sortParameters.category === '-1'){%>
              
                <option value="0" >All</option>
                <option value="-1" selected>No Category</option>
              <%} else {%>
                <option value="0">All</option>
                <option value="-1">No Category</option>
              <%}%>

              <%for( let i = 0;i < data.categories.length; i++){%>

                <%if(Number(data.sortParameters.category) === data.categories[i].id){%>
                    <option value="<%= data.categories[i].id %>" selected><%= data.categories[i].category_name %></option>
                <%} else {%>
                  <option value="<%= data.categories[i].id %>"><%= data.categories[i].category_name %></option>
                <%}%>

              <%}%>
            </select>

            <label for="isDone">Is Done:</label>
            <select name="isDone" id="isDone">
                <%if(data.sortParameters.isDone === '1'){%>
                    <option value="1" selected>Done</option>
                    <option value="2">To Do</option>
                    <option value="3">All</option>
                <%} else if(data.sortParameters.isDone === '2'){%>  
                    <option value="1">Done</option>
                    <option value="2" selected>To Do</option>
                    <option value="3">All</option>
                <%} else {%>  
                    <option value="1">Done</option>
                    <option value="2">To Do</option>
                    <option value="3" selected>All</option>
                <%}%>
            </select>

            <input type="submit" value="Sort">
        </form>
      </div>
        <h2>Tasks List</h2>
        <%if(data.result.length > 0){%>
            <table>
                <tr>
                    <%for( let i = 1;i < Object.keys(data.result[0]).length; i++){%>
                        <th><%= Object.keys(data.result[0])[i] %></th>
                    <%}%>
                </tr>
                <% for(let i = 0; i < data.result.length; i++){%>
                    <tr>
                        <form action="http://localhost:7777/tasks/<%= data.result[i].id %>" method="post">
                          <td><select name="category" id="category" >
                           
                            <%if(data.result[i].category_id === 0){%>
                              <option value="0" selected>No Category</option>
                            <%} else {%>
                              <option value="0">No Category</option>
                            <%}%>
                           
                            <%for( let k = 0;k < data.categories.length; k++){%>

                              <%if(data.result[i].category_id === data.categories[k].id){%>
                                <option value="<%= data.categories[k].id %>" selected><%= data.categories[k].category_name %></option>
                                <%} else {%>
                                  <option value="<%= data.categories[k].id %>"><%= data.categories[k].category_name %></option>
                              <%}%>

                            <%}%>
                          </select></td>
                          
                          <td><textarea name="description" id="description" placeholder="Description..." style="resize: none;" cols="30" rows="3"><%=data.result[i].description%></textarea></td> 
                          <td><input type="date" required name="date" id="date" value="<%= data.result[i].date %>"></td>
                          
                          <%if(data.result[i].is_done === 1){%>
                            <td><input type="checkbox" name="isDone" value="1" checked></td>
                          <%} else {%>
                            <td><input type="checkbox" name="isDone" value="1"></td>
                          <%}%>

                          <td>
                            <button>UPDATE</button>
                          </td>
                        </form>
                        <td>
                        <form action="http://localhost:7777/tasks/delete/<%= data.result[i].id %>" >
                            <button>DELETE</button>
                        </form>
                        </td>
                    </tr>
                <%}%>
                </table>
                <div id="pageNav">
                  <form action="http://localhost:7777/tasks/page">
                      <% if(data.page > 0) { %>
                          <button name="page" value="<%= Number(data.page)-1 %>">BACK</button>
                      <% } %>
                          PAGE <%= Number(data.page)+1 %> IN <%= data.totalPages %>
                      <% if(data.page < data.totalPages - 1) { %>
                          <button name="page" value="<%= Number(data.page)+1 %>">NEXT</button>
                      <% } %>
                  </form>
                </div>
        <%} else{%>
            <h4>No Categories Yet</h4>
        <%}%>

    </body>
</html>